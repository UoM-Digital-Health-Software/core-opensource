# CORE - Core Mental Health Dataset

A Data Collection Tool for a Core Mental Health Dataset in Physical Health Research Studies

Project Overview
The overarching aim is to create a seamless and widely acceptable mechanism to collect a common/core set of mental health data (the Core Mental Health Dataset - CMHDS) for all UK physical health study participants so that researchers can analyse the links between physical and mental health.

CMHDS Data Collection Tool
The Core Mental Health DataSet (CMHDS) Open Source tool enables the collection of mental health data from participants in physical health studies. The CMHDS data collection tool was extensively co-designed with members of the public through a series of workshops.

It has several pages of questions, presented in multiple choice format. Note: for this Open Source release, licensed questionanaires have been removed.

## Stack 
### Front-end
Project generated using [Vue CLI](https://cli.vuejs.org)

- Vue 3 
- [Cypress + Cucumber for testing] (https://www.npmjs.com/package/cypress-cucumber-preprocessor)



### Server
Project generated using [JHipster](https://www.jhipster.tech) 

- Spring Boot + Liquidbase
- [Maven](https://maven.apache.org/)
- SQL database (MariaDB)


## Identity

CORE has no authentication.

Participants are identified by a **study code** and **user code**.

A **machine UUID** is generated by a participants browser.

These three IDs are sent to the server, and the participant is given a randomly generated identifier (**user UUID**) to avoid storing the study id or participant id in their browser.

The **user UUID** is used to submit an answer set.

## Questions & Answers

The questionnaire has the following structure:
 * **QuestionSet** - an entire questionnaire
 * **QuestionPage** - a page of questions (within the set)
 * **Question** - a question (within a page)
 * **QuestionItem** - a multiple-choice option
 
The answers are stored with the following structure:
 * **AnswerSet** - a set of pages of answers, associated with an Identity
 * **AnswerPage** - a page of answers
 * **Answer** - an answer to a question
 * **AnswerItem** - a chosen multiple-choice option




Question pages are defined in this file: **./server/src/main/resources/config/liquibase/data/question_page.csv**

Questions linked to the question pages are defined in this file: **./server/src/main/resources/config/liquibase/data/question.csv**

New question items are defined in this file: **src/main/resources/config/liquibase/data/question_item.csv** 

Question Items linked to the questions are defined in this file: **./server/src/main/resources/config/liquibase/data/question_question_item.csv**

In **./utilities** there is a **generate.js** file that will generate the Liquidbase CSV for linking Questions to QuestionItems 
 
 
 

## Database Commands

### Create Database
### Create Database for Local Developemnt
```
mysql -u root
CREATE USER 'core'@'localhost' IDENTIFIED BY 'core123';
CREATE DATABASE core;
GRANT ALL ON core.* TO 'core'@'localhost';
EXIT

```

#### Clear Database
```
mysql -u root
DROP DATABASE core;
CREATE DATABASE core;
GRANT ALL ON core.* TO 'core'@'localhost';
EXIT

```


## Server

The server is built and run using Maven. Instalation guide can be found [here](https://maven.apache.org/).

### Launch Server Locally
```
mvnw
```

### Run Integration Tests

To run all tests:
```
mvnw verify
```

To run a single integration test:
```
mvnw -Dit.test=ParticipantResourceIT failsafe:integration-test
```

## Web Interface

### Install Dependencies
```
npm install
```

### Launch Web Interface Locally
```
npm run serve
```

### Accessing the web interface 
Defaulty the web interface runs on the 8500 port.
 
A query string for a study id (**study=1**) and user id (**id=1**) must be provided 

This can be any number or string 

Example:
```
http://localhost:8500/?study=1&id=1
```



### Run End-to-End Tests
These require Cypress to be installed: 
https://docs.cypress.io/guides/getting-started/installing-cypress

```
npm run tests
```

Alternatively, you may run the tests without installing Cypress globally, using npx:
```
npx cypress open --browser=chrome
```
